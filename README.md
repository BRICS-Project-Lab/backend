# BRICS AI Modules Backend

Django REST Framework backend для управления каталогом ИИ-модулей медицинской радиологии.


## Быстрый старт

### 1. Запуск сервиса

Выполните следующую команду из директории проекта:

```bash
docker-compose up --build
```

После успешного запуска сервис будет доступен по следующим адресам:
- `http://127.0.0.1:8080`
- `http://localhost:8080`
- `http://0.0.0.0:8080`

### 2. Настройка доменов и CORS

Для настройки доменов и разрешенных источников запросов необходимо изменить следующие переменные окружения в файле `.env`:

- `CSRF_TRUSTED_ORIGINS` — список доверенных источников для CSRF защиты
- `ALLOWED_HOSTS` — список разрешенных хостов
- `CORS_ALLOWED_ORIGINS` — список разрешенных источников для CORS (необходимо для работы админки)

Пример:
```
CSRF_TRUSTED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
ALLOWED_HOSTS=localhost,127.0.0.1,yourdomain.com
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
```

**Примечание:** Архитектура контейнера предусматривает использование Nginx в качестве reverse proxy. Nginx работает на порту 80 внутри контейнера и проксирует запросы к Django. Docker Compose перенаправляет порт 80 контейнера на указанный порт хоста (по умолчанию 8080) и запускает в localhost, 0.0.0.0, 127.0.0.1 (менять это в docker-compose.yml). Такая архитектура позволяет быстро настроить HTTPS и доменное имя на уровне конфигурации Nginx без изменения кода приложения.

### 3. Конфигурация базы данных и сервисов

Все настройки для подключения к базе данных, Redis и другим сервисам могут быть изменены через переменные окружения в файле `.env`:

- Настройки PostgreSQL: `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD`
- Настройки Redis: `REDIS_HOST`, `REDIS_PORT`
- Прочие настройки Django: `SECRET_KEY`, `DEBUG`, `DOMAIN_NAME`

## Инициализация данных

### Доступ к административной панели

После запуска сервиса автоматически создается административный аккаунт:
- **Логин:** `admin`
- **Пароль:** `admin123`

Административная панель доступна по адресу: `http://localhost:8080/api/admin`

### Импорт ИИ-модулей

1. Перейдите в административную панель Django (`/api/admin`)
2. Выберите модель **AI Modules**
3. Нажмите кнопку **"Импорт ИИ модулей"**
4. Загрузите файл `data_bd/ai_modules_to_import.csv`

**Формат CSV файла:**
- Разделитель: запятая (`,`)
- Кодировка: UTF-8
- Описание колонок содержится на странице импорта

### Импорт публикаций

1. Перейдите в раздел **Publications** в административной панели
2. Нажмите кнопку **"Импорт публикаций"**
3. Загрузите файл `data_bd/publications_to_import.csv`

**Важное примечание:** В связи с особенностями данных в импортируемом файле публикаций, связи между публикациями и ИИ-модулями не устанавливаются автоматически. После импорта все публикации будут прикреплены к первому ИИ-модулю в базе данных. Для корректной привязки публикаций к соответствующим модулям обратитесь к @firesieht для ручного исправления связей (ребятки из команды могут это сделать).

## API Endpoints

После инициализации данных сервис готов к использованию. Доступны следующие эндпоинты:

- `/api/v1` — основное API приложения
- `/api/auth` — сервис аутентификации и авторизации к API (сейчас почти все запросы без этого работают)
- `/api/admin` — административная панель Django
- `/api/docs` — интерактивная документация API (Swagger UI)
- `/api/schema` — схема API (OpenAPI/Swagger)
- `/health` — эндпоинт проверки работоспособности сервера


При возникновении проблем с импортом данных или необходимостью корректировки связей между сущностями обращайтесь к @firesieht.
```